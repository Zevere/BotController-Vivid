dist: trusty
sudo: required
language: node_js
node_js:
  - node
branches:
  except:
  - gh-pages
notifications:
  email: false
services:
  - docker

jobs:
  include:
    - stage: Build
      name: "Buid Docker images"
      install: cd scripts && npm ci && cd ..
      script: node scripts/build
      env:
        # DEPLOY_SETTINGS_JSON='{"CI":[{"type":"docker","options":{"user":"","pass":""}}]}'
        - secure: fc+QsZTHuoHvmTko3cKCKlL+W28mVX3GHI56YJ1TsWXMJcgm5NidlrHKrcE6VW1dkT6VFyCNNNS+N2t218tvJJAHHpjHh6RD1m/8njYqdKaxEl11kJ8pEIzOlfF/0yBSn2Aync0CxJGSdJoirScI/fmSefrtLxWqT7sLJuuFrPHiGLw9uzrBlB9jbaR1VIs90ALMEvH0Pr0dkkG4VkiFWy7HTtkFP8D0NcPn9m9+xa+UEZpJg6/nBBSjnBM6wzVNZPblAPmwalliwyi5y7OPu87K2QopxNBXOZZxbWGdQurUDSyMFtFbour+AeS+OyAnEO+6GeJDqwX5xmUcxhCnHrwLUmeqWGIlR1GzndFTD8LqU35SJ9dPtsSuFjyTMjkptvhrPXqcu7+SZ95L0x55R/fmLRla+sE8LT9xh1G+rkvPRJ04zsulpH5Z9un7Gt3BugainB95quNSJ6mDyiO2Z5NpUsd9tnrqducf/I0M1UHirJSv2ZdKgXtpYUPwVLKzmqv0s2sxmbG5Dpeg5pLDFElKHyEs26fiJ7HH5WYa3WOSf2OG05jJ+/oaJ6JavaKxNvdKsTHkJyn6nuU629PbgGD1av+WvltvhpypFDDJhKiv6wnvGgls/FOamWt2Nd3n0OwQJAJyuQZV/pXwsnNZYaHexuyommVNlkG/skhnnu8=
    - stage: Test
      name: "Vivid tests"
      install: cd scripts && npm ci && cd ..
      script: echo ToDo
    - name: "Vivid Operations - Systems Integration Tests"
      install:
        - cd scripts && npm ci && cd ..
        - docker pull zevere/botops-vivid:unstable-solution
      env:
        - image_tag=zevere/botops-vivid:unstable-solution
      script: node scripts/test/ops.integration.test.js
    - stage: Deploy
      name: "Deploy"
      script: skip
      install:
        - cd scripts && npm ci && cd ..
        - docker pull zevere/botops-vivid:unstable
      env:
        # DEPLOY_SETTINGS_JSON='{"Production":[
        #   {"type":"docker","options":{"source":"zevere/botops-vivid:unstable","target":"zevere/botops-vivid","user":"","pass":""}},
        #   {"type":"heroku","options":{"app":"zv-botops-vivid","source":"zevere/botops-vivid","dyno":"web","user":"","token":""}}
        # ]}'
        - secure: ZvcauqdSpS+g3706oT0CuVurvLBERvr5f8dGEKS3BKaNNQmlLaPqIz7Bok2GPQRkApnmerBLwA39zXaNAITpT61ZgRNtUpbWGpK9Wg+bUkPTvwZfubsqel7Lzg5HpBcA7f4bZl1gtJ2weYwXPNSPusijaxYqAoq/XN3YsawW2BfhTKDXWkMQo1cJbolTzbUTqMVfV3Rj8/0amgoOyxvYSadqlWPRhs8mk0yiszMq0hKbQtM8a5jnMyBin2P+mc93EMwL0+2GxCyWGvmwHQHftKS/fSO5DzSnzkonQkBXkSoeahdASkdOItWITXaP+HjO0HzGKEntnjBC+hPG5kbr3IGesSClzDleB2DldHdjFkh9zKTNNpf9xTiUjPLus5BfldaCr7agDK6KGvc3TxJwwnxXjXaq9h2uQokdXwK0bQkh2WtR01JVLKZsBcMPRKYEQo5Aqu8Y7doZFNfPdAqiWtSvbCyrI1Fr7FjxwbAV05GzWGUqnYVQ0egZYgjh1MoMaWCeDORN57nEq/3YeZnJAnh4JC/WFrQTsaPdX074aNRwj+Gf6w4lJG28QvGCt36Qr8KQLOViPb8V/l1ouTcYzrwRAECzPt4xRxZ9sMSoi5t4a5exRPb4ESizrLrpXMRRgEZsvUgXMZjhh0gdiFZmOYz03fYU8GE2AFfc/JSDU78=
      deploy:
        - provider: script
          skip_cleanup: true
          script: node scripts/deploy Staging
          on:
            branch: develop
    - stage: PIV
      name: "PIV Checks"
      script: echo ToDo


# Disable "Build pushed pull requests"
